<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Gap Calculator - TeacherFinCoach</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .back-link {
            display: inline-block;
            color: #667eea;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .disclaimer {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .disclaimer-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #856404;
        }

        .disclaimer-text {
            color: #856404;
            font-size: 14px;
            line-height: 1.6;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .label-hint {
            font-size: 13px;
            color: #666;
            font-weight: 400;
            margin-top: 4px;
        }

        .label-link {
            display: block;
            margin-top: 8px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 5px;
            font-size: 14px;
            color: #1976D2;
        }

        .label-link a {
            color: #1976D2;
            font-weight: 600;
            text-decoration: none;
        }

        .label-link a:hover {
            text-decoration: underline;
        }

        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
            cursor: pointer;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }

        .checkbox-container:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .checkbox-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-label {
            font-size: 16px;
            font-weight: 500;
            color: #333;
            cursor: pointer;
        }

        .spouse-section {
            display: none;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 25px;
            border: 2px solid #667eea;
        }

        .spouse-section.active {
            display: block;
        }

        .spouse-section-title {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .coach-note {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-style: italic;
        }

        .coach-note::before {
            content: "üèÄ Coach Marty says: ";
            font-weight: bold;
            font-style: normal;
            color: #1976D2;
        }

        .wep-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 10px;
            border-radius: 5px;
            font-size: 14px;
        }

        .wep-warning strong {
            color: #856404;
        }

        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 10px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .results {
            display: none;
            margin-top: 40px;
        }

        .results.active {
            display: block;
        }

        .results-header {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .income-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .breakdown-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }

        .breakdown-card.highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .breakdown-label {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .breakdown-amount {
            font-size: 28px;
            font-weight: bold;
        }

        .comparison-section {
            background: #fff;
            border: 3px solid #667eea;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }

        .comparison-title {
            font-size: 20px;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .comparison-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .comparison-row:last-child {
            margin-bottom: 0;
        }

        .comparison-label {
            font-weight: 500;
            color: #333;
        }

        .comparison-amount {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .savings-impact {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
        }

        .savings-impact-text {
            color: #155724;
            font-weight: 500;
            font-size: 16px;
        }

        .info-box {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .info-box-title {
            font-weight: 600;
            color: #1976D2;
            margin-bottom: 10px;
        }

        .action-steps {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .action-steps h3 {
            color: #333;
            margin-bottom: 20px;
        }

        .step {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: start;
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 24px;
            }

            .income-breakdown {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="dashboard.html" class="back-link">‚Üê Back to Dashboard</a>

        <div class="disclaimer">
            <div class="disclaimer-title">‚ö†Ô∏è Calculator Disclaimer</div>
            <div class="disclaimer-text">
                This calculator provides educational estimates based on the information you provide. Results are hypothetical projections
                and do not guarantee future performance. Actual pension amounts, Social Security benefits, and investment returns will vary.
                This tool does not constitute financial advice.
            </div>
        </div>

        <h1>üìä Income Gap Calculator</h1>
        <div class="subtitle">Calculate your retirement income gap and how much you need to save</div>

        <form id="gapCalculator">
            <!-- Primary User Information -->
            <div class="form-group">
                <label for="salary">Current Annual Salary
                    <div class="label-hint">Enter your gross annual salary</div>
                </label>
                <input type="number" id="salary" placeholder="e.g., 75000" required min="0" step="1000">
            </div>

            <div class="form-group">
                <label for="yearsToRetirement">Years Until Retirement
                    <div class="label-hint">Time horizon for growth</div>
                </label>
                <input type="number" id="yearsToRetirement" placeholder="e.g., 20" required min="1" max="50">
            </div>

            <div class="form-group">
                <label for="state">Which state do you teach in?
                    <div class="label-hint">We'll provide a link to your state's pension calculator</div>
                </label>
                <select id="state" required>
                    <option value="">Select your state...</option>
                    <option value="alabama">Alabama</option>
                    <option value="alaska">Alaska</option>
                    <option value="arizona">Arizona</option>
                    <option value="arkansas">Arkansas</option>
                    <option value="california">California</option>
                    <option value="colorado">Colorado</option>
                    <option value="connecticut">Connecticut</option>
                    <option value="delaware">Delaware</option>
                    <option value="florida">Florida</option>
                    <option value="georgia">Georgia</option>
                    <option value="hawaii">Hawaii</option>
                    <option value="idaho">Idaho</option>
                    <option value="illinois">Illinois</option>
                    <option value="indiana">Indiana</option>
                    <option value="iowa">Iowa</option>
                    <option value="kansas">Kansas</option>
                    <option value="kentucky">Kentucky</option>
                    <option value="louisiana">Louisiana</option>
                    <option value="maine">Maine</option>
                    <option value="maryland">Maryland</option>
                    <option value="massachusetts">Massachusetts</option>
                    <option value="michigan">Michigan</option>
                    <option value="minnesota">Minnesota</option>
                    <option value="mississippi">Mississippi</option>
                    <option value="missouri">Missouri</option>
                    <option value="montana">Montana</option>
                    <option value="nebraska">Nebraska</option>
                    <option value="nevada">Nevada</option>
                    <option value="newhampshire">New Hampshire</option>
                    <option value="newjersey">New Jersey</option>
                    <option value="newmexico">New Mexico</option>
                    <option value="newyork">New York</option>
                    <option value="northcarolina">North Carolina</option>
                    <option value="northdakota">North Dakota</option>
                    <option value="ohio">Ohio</option>
                    <option value="oklahoma">Oklahoma</option>
                    <option value="oregon">Oregon</option>
                    <option value="pennsylvania">Pennsylvania</option>
                    <option value="rhodeisland">Rhode Island</option>
                    <option value="southcarolina">South Carolina</option>
                    <option value="southdakota">South Dakota</option>
                    <option value="tennessee">Tennessee</option>
                    <option value="texas">Texas</option>
                    <option value="utah">Utah</option>
                    <option value="vermont">Vermont</option>
                    <option value="virginia">Virginia</option>
                    <option value="washington">Washington</option>
                    <option value="westvirginia">West Virginia</option>
                    <option value="wisconsin">Wisconsin</option>
                    <option value="wyoming">Wyoming</option>
                </select>
                <div id="stateCalculatorLink" class="label-link" style="display: none;"></div>
            </div>

            <div class="form-group">
                <label for="monthlyPension">Estimated Monthly Pension
                    <div class="label-hint">Use your state's calculator (link above) to get your pension estimate, then enter it here</div>
                </label>
                <input type="number" id="monthlyPension" placeholder="e.g., 4500" required min="0" step="100">
            </div>

            <div class="form-group">
                <label for="socialSecurity">Expected Monthly Social Security
                    <div class="label-hint"><strong>Don't know your estimate?</strong> <a href="https://www.ssa.gov/myaccount/" target="_blank" style="color: #1976D2; font-weight: 600;">Go to SSA.gov to get it</a></div>
                </label>
                <input type="number" id="socialSecurity" placeholder="e.g., 1500" min="0" value="0" step="100">
                <div class="wep-warning">
                    <strong>‚ö†Ô∏è Teachers with pensions:</strong> Your Social Security may be reduced by the Windfall Elimination Provision (WEP). Use the SSA calculator for your actual estimate.
                </div>
            </div>

            <div class="form-group">
                <label for="currentSavings">Current Retirement Savings (403b, 457b, IRAs)
                    <div class="label-hint">Enter 0 if starting fresh</div>
                </label>
                <input type="number" id="currentSavings" placeholder="e.g., 50000" required min="0" step="1000">
            </div>

            <!-- Spouse Section -->
            <div class="checkbox-container" onclick="document.getElementById('includeSpouse').click();">
                <input type="checkbox" id="includeSpouse" onclick="event.stopPropagation();">
                <label for="includeSpouse" class="checkbox-label">üë´ Include spouse's income & pension? (common for dual-teacher households)</label>
            </div>

            <div class="coach-note">
                Many teacher couples overlook this ‚Äî your spouse's pension and savings can close a huge chunk of the gap. Include their information to see your complete household retirement picture!
            </div>

            <div id="spouseSection" class="spouse-section">
                <div class="spouse-section-title">üë´ Spouse's Information</div>

                <div class="form-group">
                    <label for="spouseSalary">Spouse's Current Annual Salary</label>
                    <input type="number" id="spouseSalary" placeholder="e.g., 68000" min="0" step="1000">
                </div>

                <div class="form-group">
                    <label for="spouseYearsToRetirement">Spouse's Years Until Retirement</label>
                    <input type="number" id="spouseYearsToRetirement" placeholder="e.g., 15" min="1" max="50">
                </div>

                <div class="form-group">
                    <label for="spouseState">Spouse's State</label>
                    <select id="spouseState">
                        <option value="">Select state...</option>
                        <option value="alabama">Alabama</option>
                        <option value="alaska">Alaska</option>
                        <option value="arizona">Arizona</option>
                        <option value="arkansas">Arkansas</option>
                        <option value="california">California</option>
                        <option value="colorado">Colorado</option>
                        <option value="connecticut">Connecticut</option>
                        <option value="delaware">Delaware</option>
                        <option value="florida">Florida</option>
                        <option value="georgia">Georgia</option>
                        <option value="hawaii">Hawaii</option>
                        <option value="idaho">Idaho</option>
                        <option value="illinois">Illinois</option>
                        <option value="indiana">Indiana</option>
                        <option value="iowa">Iowa</option>
                        <option value="kansas">Kansas</option>
                        <option value="kentucky">Kentucky</option>
                        <option value="louisiana">Louisiana</option>
                        <option value="maine">Maine</option>
                        <option value="maryland">Maryland</option>
                        <option value="massachusetts">Massachusetts</option>
                        <option value="michigan">Michigan</option>
                        <option value="minnesota">Minnesota</option>
                        <option value="mississippi">Mississippi</option>
                        <option value="missouri">Missouri</option>
                        <option value="montana">Montana</option>
                        <option value="nebraska">Nebraska</option>
                        <option value="nevada">Nevada</option>
                        <option value="newhampshire">New Hampshire</option>
                        <option value="newjersey">New Jersey</option>
                        <option value="newmexico">New Mexico</option>
                        <option value="newyork">New York</option>
                        <option value="northcarolina">North Carolina</option>
                        <option value="northdakota">North Dakota</option>
                        <option value="ohio">Ohio</option>
                        <option value="oklahoma">Oklahoma</option>
                        <option value="oregon">Oregon</option>
                        <option value="pennsylvania">Pennsylvania</option>
                        <option value="rhodeisland">Rhode Island</option>
                        <option value="southcarolina">South Carolina</option>
                        <option value="southdakota">South Dakota</option>
                        <option value="tennessee">Tennessee</option>
                        <option value="texas">Texas</option>
                        <option value="utah">Utah</option>
                        <option value="vermont">Vermont</option>
                        <option value="virginia">Virginia</option>
                        <option value="washington">Washington</option>
                        <option value="westvirginia">West Virginia</option>
                        <option value="wisconsin">Wisconsin</option>
                        <option value="wyoming">Wyoming</option>
                    </select>
                    <div id="spouseStateCalculatorLink" class="label-link" style="display: none;"></div>
                </div>

                <div class="form-group">
                    <label for="spousePension">Spouse's Estimated Monthly Pension
                        <div class="label-hint">From their state calculator or pension statement</div>
                    </label>
                    <input type="number" id="spousePension" placeholder="e.g., 3500" min="0" value="0" step="100">
                </div>

                <div class="form-group">
                    <label for="spouseSocialSecurity">Spouse's Expected Monthly Social Security
                        <div class="label-hint">From <a href="https://www.ssa.gov/myaccount/" target="_blank" style="color: #1976D2; font-weight: 600;">SSA.gov</a></div>
                    </label>
                    <input type="number" id="spouseSocialSecurity" placeholder="e.g., 1200" min="0" value="0" step="100">
                </div>

                <div class="form-group">
                    <label for="spouseSavings">Spouse's Current Retirement Savings
                        <div class="label-hint">Their 403b, 457b, IRAs, etc.</div>
                    </label>
                    <input type="number" id="spouseSavings" placeholder="e.g., 35000" min="0" value="0" step="1000">
                </div>
            </div>

            <button type="submit" class="calculate-btn">Calculate My Income Gap</button>
        </form>

        <!-- Results Section -->
        <div id="results" class="results">
            <div class="results-header">Your Retirement Income Breakdown</div>

            <div class="income-breakdown">
                <div class="breakdown-card">
                    <div class="breakdown-label">Monthly Pension</div>
                    <div class="breakdown-amount" id="pensionAmount">$0</div>
                </div>
                <div class="breakdown-card">
                    <div class="breakdown-label">Monthly Social Security</div>
                    <div class="breakdown-amount" id="ssAmount">$0</div>
                </div>
                <div class="breakdown-card highlight">
                    <div class="breakdown-label">Monthly Income Gap</div>
                    <div class="breakdown-amount" id="gapAmount">$0</div>
                </div>
            </div>

            <!-- Household Comparison (shown when spouse included) -->
            <div id="householdComparison" class="comparison-section" style="display: none;">
                <div class="comparison-title">üíë Individual vs. Household Gap Comparison</div>
                
                <div class="comparison-row">
                    <div class="comparison-label">Your Individual Gap:</div>
                    <div class="comparison-amount" id="individualGap">$0/mo</div>
                </div>

                <div class="comparison-row">
                    <div class="comparison-label">Combined Household Gap:</div>
                    <div class="comparison-amount" id="householdGap">$0/mo</div>
                </div>

                <div class="savings-impact">
                    <div class="savings-impact-text" id="savingsImpact">
                        üí° Your spouse's pension and income reduce your household gap significantly!
                    </div>
                </div>
            </div>

            <div class="info-box">
                <div class="info-box-title">üí∞ Your Current Savings Will Grow!</div>
                <div id="savingsGrowth"></div>
            </div>

            <div class="info-box">
                <div class="info-box-title" id="contributionHeader">MONTHLY CONTRIBUTION NEEDED</div>
                <div id="contributionAmount"></div>
            </div>

            <div class="action-steps">
                <h3>Next Steps:</h3>
                <div class="step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Set up automatic contributions</div>
                        <div>to your 403(b) and/or 457(b)</div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Choose low-cost index funds</div>
                        <div>(0.15% fees or less)</div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">Increase contributions by 1% each year</div>
                        <div>as your salary grows</div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <div class="step-title">Complete the remaining modules</div>
                        <div>to learn vendor selection and enrollment</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div>¬© 2026 TeacherFinCoach. Building Wealth for Educators.</div>
            <div style="margin-top: 10px;">Educational purposes only. Not financial advice.</div>
            <div style="margin-top: 5px;"><a href="terms.html" style="color: #667eea;">Terms & Disclaimers</a></div>
        </div>
    </div>

    <script>
        // State pension calculator links
        const stateCalculatorLinks = {
            california: { name: 'CalSTRS', url: 'https://www.calstrs.com/retirement-calculator' },
            texas: { name: 'Texas TRS', url: 'https://www.trs.texas.gov/Pages/ActiveMember/estimate_retirement_benefits.aspx' },
            newyork: { name: 'NYSTRS', url: 'https://www.nystrs.org/NYSTRS/media/PDF/Library/Benefits/Pension-Calculator.pdf' },
            florida: { name: 'Florida FRS', url: 'https://www.myfrs.com/FRSPlanChoice.htm' },
            illinois: { name: 'Illinois TRS', url: 'https://trs.illinois.gov/members/calculators/index.html' },
        };

        // Toggle spouse section
        document.getElementById('includeSpouse').addEventListener('change', function() {
            const spouseSection = document.getElementById('spouseSection');
            if (this.checked) {
                spouseSection.classList.add('active');
            } else {
                spouseSection.classList.remove('active');
            }
        });

        // Show state calculator link
        document.getElementById('state').addEventListener('change', function() {
            const linkDiv = document.getElementById('stateCalculatorLink');
            const state = this.value;
            
            if (state) {
                if (stateCalculatorLinks[state]) {
                    linkDiv.innerHTML = `üìä Calculate your pension: <a href="${stateCalculatorLinks[state].url}" target="_blank">${stateCalculatorLinks[state].name} Calculator</a>`;
                } else {
                    linkDiv.innerHTML = `üìä Search Google for: "<strong>${this.options[this.selectedIndex].text} teacher pension calculator</strong>"`;
                }
                linkDiv.style.display = 'block';
            } else {
                linkDiv.style.display = 'none';
            }
        });

        // Show spouse state calculator link
        document.getElementById('spouseState').addEventListener('change', function() {
            const linkDiv = document.getElementById('spouseStateCalculatorLink');
            const state = this.value;
            
            if (state) {
                if (stateCalculatorLinks[state]) {
                    linkDiv.innerHTML = `üìä Calculate spouse's pension: <a href="${stateCalculatorLinks[state].url}" target="_blank">${stateCalculatorLinks[state].name} Calculator</a>`;
                } else {
                    linkDiv.innerHTML = `üìä Search Google for: "<strong>${this.options[this.selectedIndex].text} teacher pension calculator</strong>"`;
                }
                linkDiv.style.display = 'block';
            } else {
                linkDiv.style.display = 'none';
            }
        });

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // VERIFIED: Calculate future value with compound interest
        // Formula: FV = PV √ó (1 + r)^n
        function calculateFutureValue(presentValue, annualRate, years) {
            return presentValue * Math.pow(1 + annualRate, years);
        }

        // VERIFIED: Calculate monthly payment needed to reach future value
        // Formula: PMT = FV √ó (r / ((1+r)^n - 1))
        // Where r = monthly rate, n = total months
        function calculateMonthlyContribution(futureValueNeeded, annualRate, years) {
            const monthlyRate = annualRate / 12;
            const totalMonths = years * 12;
            
            if (monthlyRate === 0) {
                return futureValueNeeded / totalMonths;
            }
            
            // PMT = FV √ó (r / ((1+r)^n - 1))
            const denominator = Math.pow(1 + monthlyRate, totalMonths) - 1;
            return (futureValueNeeded * monthlyRate) / denominator;
        }

        document.getElementById('gapCalculator').addEventListener('submit', function(e) {
            e.preventDefault();

            // Get primary user inputs
            const salary = parseFloat(document.getElementById('salary').value);
            const yearsToRetirement = parseFloat(document.getElementById('yearsToRetirement').value);
            const monthlyPension = parseFloat(document.getElementById('monthlyPension').value);
            const socialSecurity = parseFloat(document.getElementById('socialSecurity').value) || 0;
            const currentSavings = parseFloat(document.getElementById('currentSavings').value);

            // Check if spouse is included
            const includeSpouse = document.getElementById('includeSpouse').checked;
            let spouseSalary = 0;
            let spouseYearsToRetirement = 0;
            let spousePension = 0;
            let spouseSocialSecurity = 0;
            let spouseSavings = 0;

            if (includeSpouse) {
                spouseSalary = parseFloat(document.getElementById('spouseSalary').value) || 0;
                spouseYearsToRetirement = parseFloat(document.getElementById('spouseYearsToRetirement').value) || yearsToRetirement;
                spousePension = parseFloat(document.getElementById('spousePension').value) || 0;
                spouseSocialSecurity = parseFloat(document.getElementById('spouseSocialSecurity').value) || 0;
                spouseSavings = parseFloat(document.getElementById('spouseSavings').value) || 0;
            }

            // Calculate income needed (70% of current salary)
            const monthlyIncomeNeeded = (salary * 0.70) / 12;

            // Calculate individual gap
            const totalMonthlyIncome = monthlyPension + socialSecurity;
            const individualMonthlyGap = Math.max(0, monthlyIncomeNeeded - totalMonthlyIncome);

            // Calculate household gap if spouse included
            let householdMonthlyGap = individualMonthlyGap;
            let householdIncomeNeeded = monthlyIncomeNeeded;
            
            if (includeSpouse && spouseSalary > 0) {
                const spouseMonthlyIncomeNeeded = (spouseSalary * 0.70) / 12;
                householdIncomeNeeded = monthlyIncomeNeeded + spouseMonthlyIncomeNeeded;
                const totalHouseholdIncome = totalMonthlyIncome + spousePension + spouseSocialSecurity;
                householdMonthlyGap = Math.max(0, householdIncomeNeeded - totalHouseholdIncome);
            }

            // Use household gap for savings calculation if spouse included
            const activeGap = (includeSpouse && spouseSalary > 0) ? householdMonthlyGap : individualMonthlyGap;
            
            // Total needed: Gap √ó 12 months √ó 25 years (4% withdrawal rule)
            const totalNeeded = activeGap * 12 * 25;

            // Calculate savings growth at 7% annual return
            const annualGrowthRate = 0.07;
            const futureSavings = calculateFutureValue(currentSavings, annualGrowthRate, yearsToRetirement);
            
            // Add spouse savings growth if applicable
            let totalFutureSavings = futureSavings;
            if (includeSpouse && spouseSavings > 0) {
                const spouseFutureSavings = calculateFutureValue(spouseSavings, annualGrowthRate, spouseYearsToRetirement);
                totalFutureSavings = futureSavings + spouseFutureSavings;
            }

            // Calculate remaining amount needed
            const remainingNeeded = Math.max(0, totalNeeded - totalFutureSavings);
            
            // Calculate monthly contribution
            const monthlyContribution = (remainingNeeded > 0) 
                ? calculateMonthlyContribution(remainingNeeded, annualGrowthRate, yearsToRetirement)
                : 0;

            // Update display
            document.getElementById('pensionAmount').textContent = formatCurrency(monthlyPension);
            document.getElementById('ssAmount').textContent = formatCurrency(socialSecurity);
            document.getElementById('gapAmount').textContent = formatCurrency(activeGap);

            // Show/hide household comparison
            if (includeSpouse && spouseSalary > 0) {
                document.getElementById('householdComparison').style.display = 'block';
                document.getElementById('individualGap').textContent = formatCurrency(individualMonthlyGap) + '/mo';
                document.getElementById('householdGap').textContent = formatCurrency(householdMonthlyGap) + '/mo';
                
                const gapReduction = individualMonthlyGap - householdMonthlyGap;
                if (gapReduction > 0) {
                    document.getElementById('savingsImpact').textContent = 
                        `üí° Your spouse's pension and income reduce your household gap by ${formatCurrency(gapReduction)}/month (${formatCurrency(gapReduction * 12)}/year)!`;
                } else {
                    document.getElementById('savingsImpact').textContent = 
                        `üí° Your combined household income provides a complete retirement picture!`;
                }
            } else {
                document.getElementById('householdComparison').style.display = 'none';
            }

            // Savings growth display
            if (includeSpouse && spouseSavings > 0) {
                document.getElementById('savingsGrowth').innerHTML = 
                    `Your combined savings (${formatCurrency(currentSavings + spouseSavings)}) will grow to approximately 
                    <strong>${formatCurrency(totalFutureSavings)}</strong> by retirement 
                    (assuming 7% annual growth).`;
            } else {
                document.getElementById('savingsGrowth').innerHTML = 
                    `Your ${formatCurrency(currentSavings)} will grow to approximately 
                    <strong>${formatCurrency(futureSavings)}</strong> by retirement 
                    (assuming 7% annual growth).`;
            }

            // Contribution needed display
            if (monthlyContribution === 0) {
                document.getElementById('contributionHeader').textContent = 'üéâ You\'re On Track!';
                document.getElementById('contributionAmount').innerHTML = 
                    `Your current savings will grow to cover your income gap! Keep your savings invested and maintain your course.`;
            } else {
                document.getElementById('contributionHeader').textContent = 'MONTHLY CONTRIBUTION NEEDED';
                document.getElementById('contributionAmount').innerHTML = 
                    `<div style="font-size: 36px; font-weight: bold; color: #667eea; margin: 10px 0;">
                        ${formatCurrency(monthlyContribution)}
                    </div>
                    <div style="margin-top: 10px;">
                        This monthly contribution will help you bridge the ${formatCurrency(activeGap)}/month gap.
                    </div>`;
            }

            // Show results
            document.getElementById('results').classList.add('active');
            
            // Scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
    </script>
</body>
</html>
